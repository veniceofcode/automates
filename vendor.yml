---
- name: Execute sudo su commands
  hosts: localhost
  become: true
  tasks:
    - name: Create ~/.ansible/roles directory
      file:
        path: ~/.ansible/roles
        state: directory

    - name: Clone ansible-role-podman from GitHub
      git:
        repo: https://github.com/alvistack/ansible-role-podman.git
        dest: ~/.ansible/roles/podman

    - name: Change to ~/.ansible/roles/podman directory
      shell:
        cmd: cd ~/.ansible/roles/podman
        executable: /bin/bash

    - name: Install python3 and pip for Python 3.6
      block:
        - name: Install python3.6
          apt:
            name: python3.6
            state: present
          when: ansible_pkg_mgr == 'apt'

        - name: Install python3.6
          yum:
            name: python36
            state: present
          when: ansible_pkg_mgr == 'yum'

        - name: Install pip for Python 3.6
          shell: python3.6 -m ensurepip --upgrade
          args:
            executable: /bin/bash

    - name: Upgrade pip and install requirements
      shell:
        cmd: "pip3 install --upgrade --ignore-installed --requirement ~/.ansible/roles/podman/requirements.txt"
        executable: /bin/bash

    - name: Converge molecule
      shell:
        cmd: molecule converge
        executable: /bin/bash

    - name: Verify molecule
      shell:
        cmd: molecule verify
        executable: /bin/bash
