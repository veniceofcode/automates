---
- name: Execute sudo su commands
  hosts: localhost
  become: true
  tasks:
    - name: Create ~/.ansible/roles directory
      file:
        path: ~/.ansible/roles
        state: directory

    - name: Clone ansible-role-podman from GitHub
      git:
        repo: https://github.com/alvistack/ansible-role-podman.git
        dest: ~/.ansible/roles/podman

    - name: Change to ~/.ansible/roles/podman directory
      command:
        cmd: cd ~/.ansible/roles/podman
        warn: no
        executable: /bin/bash

    - name: Upgrade pip and install requirements
      pip:
        name: "{{ item }}"
        state: latest
      with_lines:
        - cat ~/.ansible/roles/podman/requirements.txt

    - name: Converge molecule
      command:
        cmd: molecule converge
        warn: no
        executable: /bin/bash

    - name: Verify molecule
      command:
        cmd: molecule verify
        warn: no
        executable: /bin/bash
