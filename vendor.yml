---
- name: Execute sudo su commands
  hosts: localhost
  become: true
  tasks:
    - name: Create ~/.ansible/roles directory
      file:
        path: ~/.ansible/roles
        state: directory

    - name: Clone ansible-role-podman from GitHub
      git:
        repo: https://github.com/alvistack/ansible-role-podman.git
        dest: ~/.ansible/roles/podman

    - name: Change to ~/.ansible/roles/podman directory
      shell:
        cmd: cd ~/.ansible/roles/podman
        executable: /bin/bash

    - name: Install python3-pip or python-pip
      block:
        - name: Install python3-pip
          apt:
            name: python3-pip
            state: present
          when: ansible_pkg_mgr == 'apt'

        - name: Install python-pip
          yum:
            name: python-pip
            state: present
          when: ansible_pkg_mgr == 'yum'

    - name: Upgrade pip and install requirements
      shell:
        cmd: "pip3 install --upgrade --ignore-installed --requirement ~/.ansible/roles/podman/requirements.txt"
        executable: /bin/bash

    - name: Converge molecule
      shell:
        cmd: molecule converge
        executable: /bin/bash

    - name: Verify molecule
      shell:
        cmd: molecule verify
        executable: /bin/bash
