---
- name: Execute sudo su commands
  hosts: localhost
  become: true
  tasks:
    - name: Create ~/.ansible/roles directory
      file:
        path: ~/.ansible/roles
        state: directory

    - name: Clone ansible-role-podman from GitHub
      git:
        repo: https://github.com/alvistack/ansible-role-podman.git
        dest: ~/.ansible/roles/podman

    - name: Change to ~/.ansible/roles/podman directory
      shell:
        cmd: cd ~/.ansible/roles/podman
        executable: /bin/bash

    - name: Install python3 and pip using get-pip.py script
      block:
        - name: Install python3
          apt:
            name: python3
            state: present
          when: ansible_pkg_mgr == 'apt'

        - name: Install python3
          yum:
            name: python3
            state: present
          when: ansible_pkg_mgr == 'yum'

        - name: Download get-pip.py script
          get_url:
            url: https://bootstrap.pypa.io/get-pip.py
            dest: /tmp/get-pip.py

        - name: Install pip
          shell:
            cmd: "python3 /tmp/get-pip.py"
            executable: /bin/bash

    - name: Upgrade pip and install requirements
      shell:
        cmd: "pip3 install --upgrade --ignore-installed --requirement ~/.ansible/roles/podman/requirements.txt"
        executable: /bin/bash

    - name: Converge molecule
      shell:
        cmd: molecule converge
        executable: /bin/bash

    - name: Verify molecule
      shell:
        cmd: molecule verify
        executable: /bin/bash
